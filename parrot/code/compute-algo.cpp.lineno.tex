% Remember to use the lgrind style

\Head{}
\File{compute\-algo.cpp.lineno}{2014}{12}{21}{1:55}{1011}
\index{soba\_init}\Proc{soba\_init}\L{\LB{\N{1}_\V{:}_\K{void}_\V{soba\_init}(\K{int}_\V{group\_size},_\K{void}_*\V{key},_\K{int}_\V{timeout})_\{}}
\L{\LB{\N{2}_\V{:}}\Tab{6}{\V{scheduler}.\V{get\_turn}();}}
\L{\LB{\N{3}_\V{:}}\Tab{6}{\V{soba\_set}[\V{key}]_=_\K{new}_\V{soba};}}
\L{\LB{\N{4}_\V{:}}\Tab{6}{\V{soba}_\&\V{bar}_=_*\V{soba\_set}[\V{key}];}}
\L{\LB{\N{5}_\V{:}}\Tab{6}{\V{bar}.\V{group\_size}_=_\V{group\_size};}}
\L{\LB{\N{6}_\V{:}}\Tab{6}{\V{bar}.\V{timeout}_=_\V{timeout};}}
\L{\LB{\N{7}_\V{:}}\Tab{6}{\V{bar}.\V{nactive}_=_\N{0};}}
\L{\LB{\N{8}_\V{:}}\Tab{6}{\V{bar}.\V{phase}_=_\V{ARRIVE};}}
\L{\LB{\N{9}_\V{:}}\Tab{6}{\V{scheduler}.\V{put\_turn}();}}
\L{\LB{\N{10}\V{:}_\}}}
\index{soba\_wait}\Proc{soba\_wait}\L{\LB{\N{11}\V{:}_\K{void}_\V{soba\_wait}(\K{void}_*\V{key})_\{}}
\L{\LB{\N{12}\V{:}}\Tab{6}{\V{scheduler}.\V{get\_turn}();}}
\L{\LB{\N{13}\V{:}}\Tab{6}{\V{soba}_\&\V{bar}_=_*\V{soba\_set}[\V{key}];}}
\L{\LB{\N{14}\V{:}}\Tab{6}{\V{bar}.\V{nactive}++;}}
\L{\LB{\N{15}\V{:}}\Tab{6}{\K{if}(\V{bar}.\V{nactive}==\V{bar}.\V{group\_size})\{}}
\L{\LB{\N{16}\V{:}}\Tab{8}{\K{if}(\V{bar}.\V{phase}==\V{ARRIVE})\{}}
\L{\LB{\N{17}\V{:}}\Tab{10}{\V{bar}.\V{phase}_=_\V{LEAVE};}\Tab{37}{\C{}//_success,_wakeup_all.\CE{}}}
\L{\LB{\N{18}\V{:}}\Tab{10}{\V{scheduler}.\V{broadcast}((\K{void}*)\&\V{bar});}}
\L{\LB{\N{19}\V{:}}\Tab{8}{\}}}
\L{\LB{\N{20}\V{:}}\Tab{6}{\}\K{else}\{}}
\L{\LB{\N{21}\V{:}}\Tab{8}{\K{if}(\V{bar}.\V{phase}==\V{ARRIVE})\{}}
\L{\LB{\N{22}\V{:}}\Tab{10}{\V{wait}((\K{void}*)\&\V{bar},_\V{bar}.\V{timeout});}}
\L{\LB{\N{23}\V{:}}\Tab{10}{\K{if}(\V{bar}.\V{phase}==\V{ARRIVE}_\&\&_\V{bar}.\V{nactive}\<\V{bar}.\V{group\_size})\{}}
\L{\LB{\N{24}\V{:}}\Tab{12}{\V{bar}.\V{phase}_=_\V{LEAVE};}\Tab{37}{\C{}//_handle_timeout.\CE{}}}
\L{\LB{\N{25}\V{:}}\Tab{12}{\V{scheduler}.\V{broadcast}((\K{void}*)\&\V{bar});}}
\L{\LB{\N{26}\V{:}}\Tab{10}{\}}}
\L{\LB{\N{27}\V{:}}\Tab{8}{\}}}
\L{\LB{\N{28}\V{:}}\Tab{6}{\}}}
\L{\LB{\N{29}\V{:}}\Tab{6}{\V{bar}.\V{nactive}\-\-;}}
\L{\LB{\N{30}\V{:}}\Tab{6}{\K{if}(\V{bar}.\V{phase}==\V{LEAVE}_\&\&_\V{bar}.\V{nactive}==\N{0})}}
\L{\LB{\N{31}\V{:}}\Tab{8}{\V{bar}.\V{phase}_=_\V{ARRIVE};}}
\L{\LB{\N{32}\V{:}}\Tab{6}{\V{scheduler}.\V{put\_turn}();}}
\L{\LB{\N{33}\V{:}_\}}}
