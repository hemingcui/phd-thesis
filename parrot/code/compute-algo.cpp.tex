% Remember to use the lgrind style

\Head{}
\File{compute\-algo.cpp}{2014}{12}{21}{1:52}{879}
\index{soba\_init}\Proc{soba\_init}\L{\LB{\K{void}_\V{soba\_init}(\K{int}_\V{group\_size},_\K{void}_*\V{key},_\K{int}_\V{timeout})_\{}}
\L{\LB{}\Tab{2}{\V{scheduler}.\V{get\_turn}();}}
\L{\LB{}\Tab{2}{\V{soba\_set}[\V{key}]_=_\K{new}_\V{soba};}}
\L{\LB{}\Tab{2}{\V{soba}_\&\V{bar}_=_*\V{soba\_set}[\V{key}];}}
\L{\LB{}\Tab{2}{\V{bar}.\V{group\_size}_=_\V{group\_size};}}
\L{\LB{}\Tab{2}{\V{bar}.\V{timeout}_=_\V{timeout};}}
\L{\LB{}\Tab{2}{\V{bar}.\V{nactive}_=_\N{0};}}
\L{\LB{}\Tab{2}{\V{bar}.\V{phase}_=_\V{ARRIVE};}}
\L{\LB{}\Tab{2}{\V{scheduler}.\V{put\_turn}();}}
\L{\LB{\}}}
\index{soba\_wait}\Proc{soba\_wait}\L{\LB{\K{void}_\V{soba\_wait}(\K{void}_*\V{key})_\{}}
\L{\LB{}\Tab{2}{\V{scheduler}.\V{get\_turn}();}}
\L{\LB{}\Tab{2}{\V{soba}_\&\V{bar}_=_*\V{soba\_set}[\V{key}];}}
\L{\LB{}\Tab{2}{\V{bar}.\V{nactive}++;}}
\L{\LB{}\Tab{2}{\K{if}(\V{bar}.\V{nactive}==\V{bar}.\V{group\_size})\{}}
\L{\LB{}\Tab{4}{\K{if}(\V{bar}.\V{phase}==\V{ARRIVE})\{}}
\L{\LB{}\Tab{6}{\V{bar}.\V{phase}_=_\V{LEAVE};}\Tab{33}{\C{}//_success,_wakeup_all.\CE{}}}
\L{\LB{}\Tab{6}{\V{scheduler}.\V{broadcast}((\K{void}*)\&\V{bar});}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}\Tab{2}{\}\K{else}\{}}
\L{\LB{}\Tab{4}{\K{if}(\V{bar}.\V{phase}==\V{ARRIVE})\{}}
\L{\LB{}\Tab{6}{\V{wait}((\K{void}*)\&\V{bar},_\V{bar}.\V{timeout});}}
\L{\LB{}\Tab{6}{\K{if}(\V{bar}.\V{phase}==\V{ARRIVE}_\&\&_\V{bar}.\V{nactive}\<\V{bar}.\V{group\_size})\{}}
\L{\LB{}\Tab{8}{\V{bar}.\V{phase}_=_\V{LEAVE};}\Tab{33}{\C{}//_handle_timeout.\CE{}}}
\L{\LB{}\Tab{8}{\V{scheduler}.\V{broadcast}((\K{void}*)\&\V{bar});}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{4}{\}}}
\L{\LB{}\Tab{2}{\}}}
\L{\LB{}\Tab{2}{\V{bar}.\V{nactive}\-\-;}}
\L{\LB{}\Tab{2}{\K{if}(\V{bar}.\V{phase}==\V{LEAVE}_\&\&_\V{bar}.\V{nactive}==\N{0})}}
\L{\LB{}\Tab{4}{\V{bar}.\V{phase}_=_\V{ARRIVE};}}
\L{\LB{}\Tab{2}{\V{scheduler}.\V{put\_turn}();}}
\L{\LB{\}}}
