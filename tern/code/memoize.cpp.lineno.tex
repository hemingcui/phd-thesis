% Remember to use the lgrind style

\Head{}
\File{memoize.cpp.lineno}{2014}{12}{9}{1:07}{847}
\L{\LB{\N{1}_:}\Tab{6}{\V{queue\_t}_\V{activeq},_\V{waitq}[\V{N}];}}
\index{pthread\_mutex\_lock\_wrapper}\Proc{pthread\_mutex\_lock\_wrapper}\L{\LB{\N{2}_:}\Tab{6}{\V{pthread\_mutex\_lock\_wrapper}(\V{pthread\_mutex\_t}_*\V{mutex})_\{_}}
\L{\LB{\N{3}_:}\Tab{7}{\V{retry}:}}
\L{\LB{\N{4}_:}\Tab{8}{\K{while}(\V{self}()!=\V{activeq}.\V{head});_//_\V{wait}_\K{for}_\V{our}_\V{turn}}}
\L{\LB{\N{5}_:}\Tab{8}{\K{if}(!\V{phtread\_mutex\_trylock}(\V{mutex}))_\{_//_\V{mutex}_\V{acquired}_}}
\L{\LB{\N{6}_:}\Tab{10}{\V{append}(\V{schedule},_\V{self}());_//_\V{add}_\V{tid}_\V{to}_\V{schedule}}}
\L{\LB{\N{7}_:}\Tab{10}{\V{move}(\V{self}(),_\V{activeq}.\V{tail});_//_\V{give}_\V{turn}_\V{to}_\V{next}_\V{thread}}}
\L{\LB{\N{8}_:}\Tab{10}{\K{return};}}
\L{\LB{\N{9}_:_}\Tab{8}{\}}}
\L{\LB{\N{10}:_}\Tab{8}{\V{move}(\V{self}(),_\V{waitq}[\V{mutex}].\V{tail});_//_\V{deterministically}_\V{wait}}}
\L{\LB{\N{11}:_}\Tab{8}{\K{goto}_\V{retry};_//_\V{wait}_\K{for}_\V{our}_\V{turn}_\V{again}}}
\L{\LB{\N{12}:}\Tab{6}{\}}}
\index{pthread\_mutex\_unlock\_wrapper}\Proc{pthread\_mutex\_unlock\_wrapper}\L{\LB{\N{13}:}\Tab{6}{\V{pthread\_mutex\_unlock\_wrapper}(\V{pthread\_mutex\_t}_*\V{mutex})_\{}}
\L{\LB{\N{14}:_}\Tab{8}{\K{while}(\V{self}()!=\V{activeq}.\V{head});_//_\V{wait}_\K{for}_\V{our}_\V{turn}}}
\L{\LB{\N{15}:_}\Tab{8}{\V{pthread\_mutex\_unlock}(\V{mutex});_//_\V{mutex}_\V{released}}}
\L{\LB{\N{16}:_}\Tab{8}{\V{wake\_up}(\V{waitq}[\V{mutex}].\V{head});_//_\V{deterministically}_\V{wake}_\V{up}}}
\L{\LB{\N{17}:_}\Tab{8}{\V{append}(\V{schedule},_\V{self}());_//_\V{add}_\V{tid}_\V{to}_\V{schedule}}}
\L{\LB{\N{18}:_}\Tab{8}{\V{move}(\V{self}(),_\V{activeq}.\V{tail});_//_\V{give}_\V{turn}_\V{to}_\V{next}_\V{thread}}}
\L{\LB{\N{19}:}\Tab{6}{\}}}
