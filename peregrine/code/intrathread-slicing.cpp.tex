% Remember to use the lgrind style

\Head{}
\File{intrathread\-slicing.cpp}{2014}{12}{17}{17:23}{3080}
\index{slice}\Proc{slice}\L{\LB{\V{slice}(\V{trace})_\{}}
\L{\LB{}\Tab{3}{\V{cur}_=_\V{remove}_\V{tail}_\V{from}_\V{trace}}}
\L{\LB{}}
\L{\LB{}\Tab{3}{\K{if}(\V{cur}_\V{is}_\V{phi})_\{}}
\L{\LB{}\Tab{6}{\K{if}(\V{value}_\V{of}_\V{cur}_\V{in}_\V{live})_\{}}
\L{\LB{}\Tab{9}{\V{take}_\V{cur}}}
\L{\LB{}\Tab{9}{\V{find}_\V{immediate}_\V{predecessor}_\V{of}_\V{cur}}\Tab{44}{\V{that}_\V{is}_\V{executed}}}
\L{\LB{}\Tab{9}{\V{take}_\V{operand}_\V{of}_\V{cur}_\V{corresponding}_\V{to}_\K{this}_\V{predecessor}}}
\L{\LB{}\Tab{9}{\V{remove}_\V{cur}_\V{from}_\V{live}}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{3}{\}_\K{else}_\K{if}(\V{cur}_\V{is}_\V{non}\-\V{mem}_\V{instruction})_\{}}
\L{\LB{}\Tab{6}{\K{if}(\V{value}_\V{of}_\V{cur}_\V{in}_\V{live})_\{}}
\L{\LB{}\Tab{10}{\V{take}_\V{cur}}}
\L{\LB{}\Tab{10}{\V{add}_\V{operands}_\V{of}_\V{cur}_\V{to}_\V{live}}}
\L{\LB{}\Tab{10}{\V{remove}_\V{cur}_\V{from}_\V{live}}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{3}{\}_\K{else}_\K{if}(\V{cur}_\V{is}_\V{load})_\{}}
\L{\LB{}\Tab{6}{\K{if}_(\V{value}_\V{of}_\V{cur}_\V{is}_\V{in}_\V{live}_\|\,\|_\V{cur}_\V{is}_\V{already}_\V{taken}_\V{in}_\V{inter}\-\V{thread}_\V{step})_\{}}
\L{\LB{}\Tab{10}{\V{take}_\V{cur}}}
\L{\LB{}\Tab{10}{\V{add}_\V{pointer}_\V{operand}_\V{of}_\V{cur}_\V{to}_\V{live}}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{3}{\}_\K{else}_\K{if}(\V{cur}_\V{is}_\V{store})_\{}}
\L{\LB{}\Tab{6}{\K{if}_(\V{cur}_\V{is}_\V{already}_\V{taken}_\V{in}_\V{inter}\-\V{thread}_\V{step})_\{}}
\L{\LB{}\Tab{10}{\V{take}_\V{cur}}}
\L{\LB{}\Tab{10}{\C{}//_note:_don{'}t_add_value_since_we_only_need_to_fix_memory\CE{}}}
\L{\LB{}\Tab{10}{\C{}//_address_to_avoid_race\CE{}}}
\L{\LB{}\Tab{10}{\V{add}_\V{pointer}_\V{operand}_\V{of}_\V{cur}_\V{to}_\V{live}}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{6}{\K{for}_\V{each}_\V{load}_\V{in}_\V{live}_\{}}
\L{\LB{}\Tab{9}{\K{if}_(\V{pointer}_\V{operand}_\V{of}_\V{cur}_==_\V{pointer}_\V{operand}_\V{of}_\V{load})_\{}}
\L{\LB{}\Tab{13}{\V{take}_\V{cur}_\K{if}_\V{it}_\V{is}_\V{not}_\V{taken}_\V{yet}}}
\L{\LB{}\Tab{13}{\C{}//_below_code_corresponds_to_updatebetween_in_bouncer\CE{}}}
\L{\LB{}\Tab{13}{\K{if}(\V{both}_\V{are}_\V{concrete})_\{}}
\L{\LB{}\Tab{16}{\C{}//_this_removal_is_safe_since_the_control_dependencies_for\CE{}}}
\L{\LB{}\Tab{16}{\C{}//_cur_and_load_are_fixed_by_taking_them_into_the_slice\CE{}}}
\L{\LB{}\Tab{16}{\V{remove}_\V{load}_\V{from}_\V{live}}}
\L{\LB{}\Tab{13}{\}_\K{else}_\{}}
\L{\LB{}\Tab{16}{\C{}//_Also_possible:_can_leave_the_load_in_live_without\CE{}}}
\L{\LB{}\Tab{16}{\C{}//_adding_constraints\CE{}}}
\L{\LB{}\Tab{16}{\V{add}_\V{constraints}_\V{to}_\V{make}_\V{the}_\V{two}_\V{pointer}_\V{operands}_\V{equal}}}
\L{\LB{}\Tab{16}{\V{remove}_\V{load}_\V{from}_\V{live}}}
\L{\LB{}\Tab{13}{\}}}
\L{\LB{}\Tab{13}{\V{add}_\V{value}_\K{and}_\V{pointer}_\V{operand}_\V{of}_\V{cur}_\V{to}_\V{live}}}
\L{\LB{}\Tab{9}{\}_\K{else}_\K{if}(\V{pointer}_\V{operand}_\V{of}_\V{cur}_\V{may}_\V{alias}_\V{operand}_\V{of}_\V{load})_\{}}
\L{\LB{}\Tab{13}{\V{take}_\V{cur}_\K{if}_\V{it}_\V{is}_\V{not}_\V{taken}_\V{yet}}}
\L{\LB{}\Tab{13}{\V{add}_\V{value}_\K{and}_\V{pointer}_\V{operand}_\V{of}_\V{cur}_\V{to}_\V{live}}}
\L{\LB{}\Tab{13}{\C{}//_bouncer_has_an_additional_optimization:_if_cur_is\CE{}}}
\L{\LB{}\Tab{13}{\C{}//_determined_by_concrete_values_in_live,_don{'}t_take_it.\CE{}}}
\L{\LB{}\Tab{13}{\C{}//_since_next_run,_the_concrete_values_in_live_will_get_the\CE{}}}
\L{\LB{}\Tab{13}{\C{}//_same_value,_so_cur_will_get_the_same_pointer_operand_value\CE{}}}
\L{\LB{}\Tab{9}{\}}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{3}{\}_\K{else}_\K{if}(\V{cur}_\V{is}_\V{branch})_\{}}
\L{\LB{}\Tab{5}{\K{if}(!\V{postdominate}(\V{slice}.\V{head},_\V{cur})}}
\L{\LB{}\Tab{8}{\|\,\|_\V{writtenbetween}(\V{cur},_\V{slice}.\V{head})}}
\L{\LB{}\Tab{8}{\|\,\|_\V{syncbetween}(\V{cur},_\V{slice}.\V{head}))_\{}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{3}{\}_\K{else}_\K{if}(\V{cur}_\V{is}_\V{ret})_\{}}
\L{\LB{}\Tab{5}{\V{call}_=_\V{trace}.\V{findcall}(\V{cur});}}
\L{\LB{}\Tab{5}{\K{if}(\V{maywriteF}(\V{calledFunc}(\V{call}),_\V{live})}}
\L{\LB{}\Tab{7}{\|\,\|_\V{maysync}(\V{calledFunc}(\V{call})))_\{}}
\L{\LB{}\Tab{7}{\V{take}_\V{cur}}}
\L{\LB{}\Tab{5}{\}_\K{else}}}
\L{\LB{}\Tab{7}{\V{jump}_\V{to}_\V{call}}}
\L{\LB{}\Tab{3}{\}_\K{else}_\K{if}(\V{cur}_\V{is}_\V{call})_\{}}
\L{\LB{}\Tab{5}{\V{take}_\V{cur}}}
\L{\LB{}\Tab{5}{\V{take}_\V{arg}_\V{setup}}}
\L{\LB{}\Tab{3}{\}}}
\L{\LB{\}}}
\L{\LB{}}
\index{maywriteF}\Proc{maywriteF}\L{\LB{\V{maywriteF}(\V{function},_\V{live})_\{}}
\L{\LB{}\Tab{3}{\K{for}_\V{each}_\V{store}_\V{reachable}_\V{from}_\V{function}_\{}}
\L{\LB{}\Tab{6}{\K{for}_\V{each}_\V{load}_\V{in}_\V{live}_\{}}
\L{\LB{}\Tab{10}{\K{if}_\V{pointer}_\V{operand}_\V{of}_\V{load}_\V{may}_\V{alias}_\V{pointer}_\V{operand}_\V{of}_\V{store}}}
\L{\LB{}\Tab{14}{\K{return}_\K{true};}}
\L{\LB{}\Tab{6}{\}}}
\L{\LB{}\Tab{3}{\}}}
\L{\LB{}\Tab{3}{\K{return}_\K{false};}}
\L{\LB{\}}}
\L{\LB{}}
\index{writtenbetween}\Proc{writtenbetween}\L{\LB{\V{writtenbetween}(\V{cur},_\V{head})_\{}}
\L{\LB{}\Tab{2}{\V{postdom}_=_\V{postdominator}_\V{of}_(\V{cur}.\K{true},_\V{cur}.\K{false})}}
\L{\LB{}\Tab{2}{\K{for}_\V{each}_\V{store}_\V{in}_[\V{cur},_\V{postdom}]}}
\L{\LB{}\Tab{5}{\K{if}_\V{pointer}_\V{operand}_\V{of}_\V{load}_\V{may}_\V{alias}_\V{pointer}_\V{operand}_\V{of}_\V{store}}}
\L{\LB{}\Tab{8}{\K{return}_\K{true};}}
\L{\LB{}\Tab{2}{\K{for}_\V{each}_\V{value}_\V{in}_\V{liveset}}}
\L{\LB{}\Tab{5}{\K{if}_\V{value}_\V{is}_\K{defined}_\V{in}_[\V{cur},_\V{postdom}]}}
\L{\LB{}\Tab{8}{\K{return}_\K{true};}}
\L{\LB{}\Tab{2}{\K{return}_\K{false};}}
\L{\LB{\}}}
