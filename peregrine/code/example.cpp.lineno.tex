% Remember to use the lgrind style

\Head{}
\File{example.cpp.lineno}{2014}{12}{18}{0:10}{1057}
\L{\LB{\N{1}_\V{:}}\Tab{9}{\K{int}_\V{size};_\C{}//_total_size_of_data\CE{}}}
\L{\LB{\N{2}_\V{:}}\Tab{9}{\K{int}_\V{nthread};_\C{}//_total_number_of_threads\CE{}}}
\L{\LB{\N{3}_\V{:}}\Tab{9}{\K{unsigned}_\K{long}_\V{result}_=_\N{0};}}
\L{\LB{\N{4}_\V{:}_}}
\index{main}\Proc{main}\L{\LB{\N{5}_\V{:}}\Tab{9}{\K{int}_\V{main}(\K{int}_\V{argc},_\K{char}_*\V{argv}[\,])_\{}}
\L{\LB{\N{6}_\V{:}}\Tab{5}{\V{L1:}}\Tab{13}{\V{nthread}_=_\V{atoi}(\V{argv}[\N{1}]);}}
\L{\LB{\N{7}_\V{:}}\Tab{5}{\V{L2:}}\Tab{13}{\V{size}_=_\V{atoi}(\V{argv}[\N{2}]);}}
\L{\LB{\N{8}_\V{:}}\Tab{5}{\V{L3:}}\Tab{13}{\V{assert}(\V{nthread}\>\N{0}_\&\&_\V{size}\>=\V{nthread});}}
\L{\LB{\N{9}_\V{:}}\Tab{5}{\V{L4:}}\Tab{13}{\K{for}(\K{int}_\V{i}=\N{1};_\V{i}\<\V{nthread};_++\V{i})}}
\L{\LB{\N{10}\V{:}}\Tab{5}{\V{L5:}}\Tab{17}{\V{pthread\_create}(.\,.\,.,_\V{worker},_\V{NULL});}}
\L{\LB{\N{11}\V{:}}\Tab{5}{\V{L6:}}\Tab{13}{\V{worker}(\V{NULL});}}
\L{\LB{\N{12}\V{:}}\Tab{12}{\C{}//_NOTE:_missing_\CE{}\V{pthread\_join}()\C{}\CE{}}}
\L{\LB{\N{13}\V{:}}\Tab{5}{\V{L7:}}\Tab{13}{\K{if}(\V{atoi}(\V{argv}[\N{3}])_==_\N{1})}}
\L{\LB{\N{14}\V{:}}\Tab{5}{\V{L8:}}\Tab{17}{\V{result}_+=_.\,.\,.;_\C{}//_race_with_line_\CE{}\V{L15}\C{}\CE{}}}
\L{\LB{\N{15}\V{:}}\Tab{5}{\V{L9:}}\Tab{13}{\V{printf}(\S{}\3result_=_\%lu\2n\3\SE{},_\V{result});_\C{}//_race_with_line_\CE{}\V{L15}\C{}\CE{}}}
\L{\LB{\N{16}\V{:}}\Tab{13}{.\,.\,.}}
\L{\LB{\N{17}\V{:}}\Tab{9}{\}}}
\index{worker}\Proc{worker}\L{\LB{\N{18}\V{:}}\Tab{9}{\K{void}_*\V{worker}(\K{void}_*\V{arg})_\{}}
\L{\LB{\N{19}\V{:}_\V{L10:}}\Tab{13}{\K{char}_*\V{data}_=_\V{malloc}(\V{size}/\V{nthread});}}
\L{\LB{\N{20}\V{:}_\V{L11:}}\Tab{13}{\V{read}(.\,.\,.,_\V{data},_\V{size}/\V{nthread});}}
\L{\LB{\N{21}\V{:}_\V{L12:}}\Tab{13}{\K{for}(\K{int}_\V{i}=\N{0};_\V{i}\<\V{size}/\V{nthread};_++\V{i})}}
\L{\LB{\N{22}\V{:}_\V{L13:}}\Tab{17}{\V{data}[\V{i}]_=_.\,.\,.;_\C{}//_compute_using_\CE{}\V{data}\C{}\CE{}}}
\L{\LB{\N{23}\V{:}_\V{L14:}}\Tab{13}{\V{pthread\_mutex\_lock}(\&\V{mutex});}}
\L{\LB{\N{24}\V{:}_\V{L15:}}\Tab{13}{\V{result}_+=_.\,.\,.;_\C{}//_race_with_lines_\CE{}\V{L8}\C{}_and_\CE{}\V{L9}\C{}\CE{}}}
\L{\LB{\N{25}\V{:}_\V{L16:}}\Tab{13}{\V{pthread\_mutex\_unlock}(\&\V{mutex});}}
\L{\LB{\N{26}\V{:}}\Tab{13}{.\,.\,.}}
\L{\LB{\N{27}\V{:}}\Tab{9}{\}}}
